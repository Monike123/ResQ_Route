 status, pending admin review.
*   **Emergency Trigger Thresholds**: Defined for the Stationary Deadman System (e.g., <10m movement in 20 minutes) and voice activation sensitivity.

## 6. AI Integration Logic

Google Gemini AI plays a crucial role in enhancing the accuracy and intelligence of the safety scoring.

### 6.1. Crime Data Analysis

*   **Process**: For each candidate route, detailed waypoints are extracted (e.g., every 100 meters). The system queries the PostGIS database for historical crime data within a defined radius (e.g., 500 meters) around each waypoint.
*   **Gemini Role**: The aggregated crime data (type, date, severity, description) is then sent to the Gemini API with a specific prompt. Gemini analyzes this data to provide:
    *   Severity categorization (low/medium/high for each incident).
    *   Overall risk assessment for the route segment.
    *   Time-based patterns (e.g., higher crime rates at night).
    *   Recommendations for mitigating risks.
*   **Output**: Gemini's structured JSON response (e.g., `severity_breakdown`, `overall_risk`, `summary`, `recommendations`) is used to calculate the `CrimeFactor` and provide contextual safety explanations to the user.

### 6.2. AI-Aggregated Crime News

*   **Process**: The AI Crime Analysis Service (a background component) continuously monitors news feeds and public safety reports. It uses Gemini to identify and extract crime-related incidents, geolocate them, and assess their severity.
*   **Integration**: This AI-aggregated news data is then imported into the `crime_data` table, enriching the dataset used for route safety calculations.

## 7. Edge Cases

*   **No Crime Data**: If no crime data is available for a route, the `CrimeFactor` defaults to a neutral or average score, or is excluded from the calculation with a warning.
*   **Sparse User Flags**: Routes with very few user flags might rely more heavily on other factors.
*   **API Failures**: Fallback mechanisms are in place for Google Maps, Google Places, and Gemini API failures (e.g., using cached data, returning partial results, or retrying).
*   **Geospatial Accuracy**: GPS drift and accuracy limitations are accounted for in stationary detection and proximity calculations.

## 8. Confidence Scoring

Each safety score can be associated with a confidence score, indicating the reliability of the underlying data. Factors influencing confidence include:

*   **Data Freshness**: Newer crime data and user flags contribute to higher confidence.
*   **Data Density**: Routes passing through areas with rich historical data yield higher confidence scores.
*   **Source Verification**: Verified crime data and admin-approved unsafe zones increase confidence.
*   **AI Model Confidence**: The confidence level provided by the Gemini API for its analysis.

## 9. Recalibration Mechanism

The safety algorithm is designed for continuous improvement through a feedback loop:

*   **User Feedback**: User ratings and comments on route safety, along with confirmations or disputes of unsafe zones, directly feed into the recalibration process.
*   **Admin Verification**: Administrators review user-flagged unsafe areas and crime data, verifying their accuracy and adjusting severity scores.
*   **AI Retraining**: The collected feedback and verified data are used to retrain and fine-tune the Gemini AI models, improving their accuracy in crime analysis and risk assessment.
*   **Weight Adjustment**: The system periodically analyzes the correlation between predicted safety scores and actual user experiences/incidents to suggest adjustments to the factor weights.

## 10. Simulation Examples

To validate and refine the algorithm, various simulation scenarios are employed:

*   **Scenario 1: High Crime Area**: Simulate a route passing through an area with recent, high-severity crime incidents. Expected outcome: Significantly lower safety score, highlighted risk hotspots, and AI recommendations for alternative routes or increased vigilance.
*   **Scenario 2: Well-Lit Commercial Zone**: Simulate a route through a busy commercial district with good lighting and no reported incidents. Expected outcome: High safety score due to commercial points and lighting, with minimal crime/flag impact.
*   **Scenario 3: Rural, Unlit Path**: Simulate a route through a sparsely populated, poorly lit area. Expected outcome: Lower safety score primarily due to the lighting factor, even if crime data is scarce.
*   **Scenario 4: User-Flagged Hotspot**: Simulate a route passing through an area with multiple recent user flags for suspicious activity. Expected outcome: Reduced safety score, with the Flag Factor playing a significant role, and a prompt for admin review of the flagged zone.
